name: Build Host Image

on:
  workflow_dispatch:
    inputs:
      host:
        description: 'Host to build image for'
        required: true
        default: 'johnny-walker'
        type: choice
        options:
          - johnny-walker

permissions:
  contents: read

jobs:
  build-image:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@11bd71901bbe5b1630ceea73d27597364c9af683 # v4.2.2
      - uses: DeterminateSystems/nix-installer-action@a2bbe0274e3a0c4194390a1e445f734c597ebc37 # v16

      - name: Build ${{ inputs.host }} Image
        run: nix build .#${{ inputs.host }}-image

      - name: Upload Artifact
        uses: actions/upload-artifact@65c4c4a1ddee5b72f698fdd19549f0f0fb45cf08 # v4.6.0
        with:
          name: ${{ inputs.host }}-image
          path: result/*
          if-no-files-found: error
